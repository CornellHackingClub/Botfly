<!DOCTYPE html>
<html>
{% include 'header.html' %}
{% include 'nav.html' %}
<body>
<!-- Page Content -->
<div class="container">
    <div class="row">
        <div class="col-md-3">
            <ul>
                <form id="upload-file" method="post" enctype="multipart/form-data">
                    <fieldset>
                        <label class="btn btn-primary btn-block btn-file ">
                            Upload File <input name="file" type="file" style="display: none;">
                        </label>
                    </fieldset>
                </form>
            </ul>
            <ul>
                <div class="well">
                    <div class="row error">
                        <input type="search" class="search-query form-control search-payload"
                               placeholder="Search payloads..."/>
                    </div>

                    <div class="row payload-desc">
                        <div class="panel-group payloads" id="accordion">
                        </div>
                    </div>
                </div>
            </ul>

        </div>
        <!--</form>-->

        <div class="col-md-9">
            <div id="terminal"></div>
        </div>
    </div>
    <!-- /.row -->
</div>
<!-- /.container -->
<script>
    lastOut = []

    terminal = $('#terminal').terminal(function (command, term) {
        //no bot selected
        if ('{{connected}}' == '') {
            terminal.error('No bot selected.');
            return;
        }
        if (command == 'kill') {
            $.get("/kill", function (response) {
                console.log(response)
            })
        }

        //send terminal command to server
        socket.emit('send_command', {data: command});
        socket.removeAllListeners('send_command'); //Sloppy, fix this if can. should be outside terminal function ideally
    }, {
        greetings: 'Botfly Terminal',
        //update prompt to be name of current user
        prompt: function (callback) {
            callback('{{connected}}> ');
        },
        convertLinks: false,
        tabcompletion: true,
        completion: function (terminal, command, callback) {
            callback(commonCommands.concat(lastOut));
        },
        onClear: function (terminal) {
            $.get("/clear", function (response) {
                console.log(response)
            })
        },
    });


</script>

<script src="{{ url_for('static', filename='js/index.js') }}"></script>

</body>
</html>